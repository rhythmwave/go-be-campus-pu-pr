-- +goose Up
-- +goose StatementBegin

CREATE TABLE "students" (
  "id" uuid NOT NULL PRIMARY KEY DEFAULT uuid_generate_v4(),
  "name" character varying NOT NULL,
  "sex" character varying NULL,
  "marital_status" character varying NULL,
  "birth_regency_id" integer NULL REFERENCES "regencies" ("id") ON DELETE SET NULL ON UPDATE CASCADE,
  "birth_date" date NULL,
  "religion" character varying NULL,
  "address" character varying NULL,
  "rt" character varying NULL,
  "rw" character varying NULL,
  "village_id" integer NULL REFERENCES "villages" ("id") ON DELETE SET NULL ON UPDATE CASCADE,
  "postal_code" character varying NULL,
  "previous_address" character varying NULL,
  "id_number" character varying NULL,
  "npwp_number" character varying NULL,
  "nisn_number" character varying NULL,
  "residence_type" character varying NULL,
  "transportation_mean" character varying NULL,
  "kps_receiver" character varying NULL,
  "phone_number" character varying(20) NULL,
  "mobile_phone_number" character varying(20) NULL,
  "email" character varying(100) NULL,
  "homepage" character varying NULL,
  "work_type" character varying NULL,
  "work_place" character varying NULL,
  "nationality" character varying NULL,
  "askes_number" character varying NULL,
  "total_brother" integer NULL,
  "total_sister" integer NULL,
  "hobby" character varying NULL,
  "experience" character varying NULL,
  "total_dependent" integer NULL,
  "nim_number" character varying NOT NULL,
  "student_force" character(4) NULL CHECK ("student_force" ~ '^[0-9\.]+$'),
  "admittance_semester" character varying NULL,
  "study_program_id" uuid NULL REFERENCES "study_programs" ("id") ON DELETE RESTRICT ON UPDATE CASCADE,
  "curriculum_id" uuid NULL REFERENCES "curriculums" ("id") ON DELETE RESTRICT ON UPDATE CASCADE,
  "admittance_test_number" character varying NULL,
  "admittance_date" date NULL,
  "admittance_status" character varying NULL,
  "total_transfer_credit" integer NULL,
  "previous_college" character varying NULL,
  "previous_study_program" character varying NULL,
  "previous_nim_number" character varying NULL,
  "previous_nim_admittance_year" character(4) NULL CHECK ("previous_nim_admittance_year" ~ '^[0-9\.]+$'),
  "status" character varying NULL,
  "is_foreign_student" boolean NULL,
  "college_entrance_type" character varying NULL,
  "class_time" character varying NULL,
  "fund_source" character varying NULL,
  "is_scholarship_grantee" boolean NULL,
  "has_complete_requirement" boolean NULL,
  "school_certificate_type" character varying NULL,
  "school_graduation_year" character(4) NULL CHECK ("school_graduation_year" ~ '^[0-9\.]+$'),
  "school_name" character varying NULL,
  "school_accreditation" character varying NULL,
  "school_address" character varying NULL,
  "school_major" character varying NULL,
  "school_certificate_number" character varying NULL,
  "school_certificate_date" date NULL,
  "total_school_final_exam_subject" integer NULL,
  "school_final_exam_score" numeric(4,2) NULL,
  "guardian_name" character varying NULL,
  "guardian_birth_date" date NULL,
  "guardian_death_date" date NULL,
  "guardian_address" character varying NULL,
  "guardian_regency_id" integer NULL REFERENCES "regencies" ("id") ON DELETE SET NULL ON UPDATE CASCADE,
  "guardian_postal_code" character varying NULL,
  "guardian_phone_number" character varying(20) NULL,
  "guardian_email" character varying(100) NULL,
  "guardian_final_academic_background" character varying NULL,
  "guardian_occupation" character varying NULL,
  "father_id_number" character varying NULL,
  "father_name" character varying NULL,
  "father_birth_date" date NULL,
  "father_death_date" date NULL,
  "mother_id_number" character varying NULL,
  "mother_name" character varying NULL,
  "mother_birth_date" date NULL,
  "mother_death_date" date NULL,
  "parent_address" character varying NULL,
  "parent_regency_id" integer NULL REFERENCES "regencies" ("id") ON DELETE SET NULL ON UPDATE CASCADE,
  "parent_postal_code" character varying NULL,
  "parent_phone_number" character varying(20) NULL,
  "parent_email" character varying(100) NULL,
  "father_final_academic_background" character varying NULL,
  "father_occupation" character varying NULL,
  "mother_final_academic_background" character varying NULL,
  "mother_occupation" character varying NULL,
  "parent_income" numeric(10,2) NULL,
  "is_financially_capable" boolean NULL,
  "created_by" uuid NOT NULL REFERENCES "admins" ("id") ON DELETE RESTRICT ON UPDATE CASCADE,
  "updated_by" uuid NULL REFERENCES "admins" ("id") ON DELETE RESTRICT ON UPDATE CASCADE,
  "created_at" timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updated_at" timestamp NULL
);
CREATE TRIGGER "updated_at_students" BEFORE UPDATE ON "students" FOR EACH ROW EXECUTE PROCEDURE trigger_set_timestamp();

CREATE TABLE "deleted_students" AS TABLE "students" WITH NO DATA;
CREATE TRIGGER "soft_delete_students" BEFORE DELETE ON "students" FOR EACH ROW EXECUTE PROCEDURE trigger_soft_delete();

-- +goose StatementEnd

-- +goose Down
-- +goose StatementBegin

DROP TABLE "deleted_students";
DROP TABLE "students";

-- +goose StatementEnd
